<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Embed YouTube Video</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
</head>
<body>
    <p> Paste a youtube link: </p>
    <form class="form-horizontal" method="get" action="#">
        <input type="text" name="youtubeID" id="youtubeID" placeholder="Paste a Youtube link.">
        <div id="preview"></div>
        <button type="button" id="insert-btn">Insert</button>
    </form>
</body>
<script type="text/javascript">
    var timer;

    /*
     * Return youtube id
     * @param url {string}
     * @return {string|boolean}
     */
    function youtubeId(url) {
        var match = url.match((/(youtu\.be\/|[?&]v=)([^&]+)/));
        return (match && match[2].length === 11) ? match[2] : false;
    }

    function convertUrl(url) {
        var id = youtubeId(url);
        if (url && id) {
            return "//www.youtube.com/embed/" + id;
        }
        return false;
    }

    function dataToHtml(url) {
        if(url){
            return "<iframe width=\"560\" height=\"315\" src=\"" + url + "\" frameborder=\"0\" allowfullscreen></iframe>"  
        }
        return "<p> Sorry, wrong url. </p>";
    }

    function insert() {
        return dataToHtml(convertUrl($('#youtubeID').val()));
    }

    function preview() {
        $("#preview").html(
            dataToHtml(convertUrl($('#youtubeID').val()))
        );
    }

    /**
     * Update Timer with keypress
     * @param ts {number} (optional)
     */
     function updateTimer(ts) {
        clearTimeout(timer);
        timer = setTimeout(preview, ts || 1000);
    }

    function run() {
        var data = insert();
        if (data) {
            parent.tinymce.activeEditor.insertContent(data);
        }
        parent.tinymce.activeEditor.windowManager.close();
    }

    function runPreview() {
        if ($("#preview").length) {
            $('#youtubeID').keypress(function () {
                updateTimer();
            }).change(function () {
                updateTimer(100);
            });
        }
    }

    $(function () {
        runPreview();
        $("#insert-btn").on("click", run);
    });
</script>
</html>
